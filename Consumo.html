<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <title>Calculadora Energética Pro + Contaminantes</title>

    <style>
        /* --- ESTILOS GENERALES --- */
        :root {
            --color-dark-green: #111a11;
            --color-mid-green: #1f371f;
            --color-light-bg: #e6e3dd;
            --color-text-light: #ffffff;
            --color-text-dark: #333;
            --color-accent: #fdd835; 
            --electric-border-color: #fdd835;
            --color-neutral-900: oklch(0.185 0 0);
        }

        body {
            font-family: 'Arial', sans-serif;
            font-size: 18px; 
            margin: 0; padding: 0;
            background-color: var(--color-light-bg);
            color: var(--color-text-dark);
            display: flex; flex-direction: column; min-height: 100vh;
            line-height: 1.6;
        }

        /* HEADER */
        .main-header {
            background-color: var(--color-dark-green);
            position: sticky; top: 0; z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            padding: 10px 0;
        }
        .header-content {
            max-width: 1200px; margin: 0 auto; padding: 0 20px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo { font-size: 24px; font-weight: bold; color: #fff; display: flex; gap: 10px; align-items: center; }
        .logo i { color: var(--color-accent); }
        
        .btn-header {
            background-color: #8cc63f; color: #ffffff !important;
            padding: 10px 30px; border-radius: 50px; font-weight: bold;
            text-decoration: none; transition: all 0.3s ease; border: 2px solid #8cc63f;
            font-size: 16px;
        }
        .btn-header:hover { background-color: transparent; color: #8cc63f !important; }
        .main-nav ul { list-style: none; padding: 0; margin: 0; }

        .container { max-width: 1000px; margin: 0 auto; padding: 40px 20px; flex: 1; }

        /* INTRO */
        .intro-header {
            background-color: var(--color-dark-green); color: #fff;
            padding: 40px; text-align: center; border-radius: 15px; margin-bottom: 40px;
        }
        .intro-header h1 { color: var(--color-accent); margin-bottom: 10px; }
        .btn-comenzar {
            background-color: var(--color-accent); color: var(--color-dark-green);
            border: none; padding: 12px 30px; font-weight: bold; border-radius: 50px;
            cursor: pointer; transition: transform 0.2s; font-size: 1em;
        }
        .btn-comenzar:hover { transform: scale(1.05); }

        /* FORMULARIO */
        .modulo-container { display: none; animation: fadeIn 0.5s ease; }
        .modulo-container.visible { display: block; }

        .form-card {
            background: white; padding: 30px; border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 30px;
        }
        .form-grid {
            display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 15px; align-items: end;
        }
        .input-group label { display: block; font-weight: bold; margin-bottom: 5px; font-size: 0.9em; }
        .input-group input { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 6px; font-size: 1em; }
        
        .btn-add {
            background-color: var(--color-dark-green); color: white; border: none;
            padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; height: 46px; width: 100%;
        }
        .btn-add:hover { background-color: var(--color-mid-green); }

        .device-list { margin-top: 20px; }
        .device-item {
            background: #f9f9f9; padding: 15px; border-radius: 8px;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 10px; border-left: 4px solid var(--color-accent);
            animation: slideIn 0.3s ease;
        }
        .device-info { display: flex; gap: 20px; font-size: 0.9em; flex-wrap: wrap; }
        .device-name { font-weight: bold; min-width: 150px; }
        
        .btn-delete {
            background: #ff5252; color: white; border: none; width: 30px; height: 30px;
            border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .btn-calcular-final {
            width: 100%; padding: 15px; background: var(--color-accent); color: var(--color-dark-green);
            border: none; font-size: 1.2em; font-weight: bold; border-radius: 8px; cursor: pointer; margin-top: 20px;
        }
        .btn-calcular-final:hover { filter: brightness(0.95); }

        /* RESULTADOS */
        .resultados-section {
            display: none; background-color: var(--color-neutral-900); color: #fff;
            padding: 50px 20px; border-radius: 20px; margin-top: 20px; text-align: center;
        }
        .resultados-section.visible { display: block; animation: fadeIn 0.8s; }

        /* Tarjeta Eléctrica */
        .main-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 30px; }
        .card-container {
            position: relative; padding: 2px; border-radius: 24px;
            background: linear-gradient(-30deg, var(--color-accent), transparent, var(--color-accent));
            box-shadow: 0 0 20px rgba(253, 216, 53, 0.2);
        }
        .canvas-container { position: relative; width: 320px; height: 550px; }
        .electric-border-canvas { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 420px; height: 650px; pointer-events: none; }
        .content-container { position: absolute; inset: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 20px; }
        
        .title { font-size: 2.5em; font-weight: 700; color: #fff; margin: 10px 0; }
        .gha-valor { font-size: 3em; font-weight: bold; color: var(--color-accent); line-height: 1; }
        .label-result { font-size: 0.85em; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px; margin-top: 5px; }
        
        .pollutant-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; margin-top: 20px;
        }
        .pollutant-box {
            background: rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; text-align: center;
        }
        .pollutant-val { font-size: 1.2em; font-weight: bold; color: #ffab91; }
        .pollutant-lbl { font-size: 0.7em; opacity: 0.8; display: block;}

        /* Sección Fórmulas */
        .technical-specs {
            background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px; padding: 20px; margin-top: 30px; text-align: left;
            font-family: 'Courier New', monospace; font-size: 0.9em; color: #ccc;
            max-width: 700px; margin-left: auto; margin-right: auto;
        }
        .formula-box {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 5px;
            margin-bottom: 15px; border-left: 3px solid var(--color-accent);
        }
        .formula-title { color: var(--color-accent); font-weight: bold; margin-bottom: 5px; display: block; }
        .variable { color: #4db6ac; }

        /* Gráfica y Recomendaciones */
        .chart-wrapper { 
            max-width: 800px; margin: 40px auto; background: rgba(255,255,255,0.05); 
            padding: 20px; border-radius: 12px;
        }

        .recommendations-box {
            max-width: 800px; margin: 40px auto; text-align: left;
            background: #fff; color: #333; padding: 30px; border-radius: 12px;
            display: none; /* OCULTO POR DEFECTO */
            border: 2px solid #ff5252; /* Borde rojo para indicar alerta */
        }
        
        .recommendations-box h3 { color: #d32f2f; text-align: center; margin-top: 0; }
        .recommendations-box ul { padding-left: 20px; }
        .recommendations-box li { margin-bottom: 10px; }

        .efficiency-message {
            max-width: 800px; margin: 20px auto; text-align: center;
            background: rgba(140, 198, 63, 0.2); color: #8cc63f; padding: 20px; border-radius: 12px;
            border: 1px solid #8cc63f; display: none; /* Oculto por defecto */
        }

        .btn-volver {
            background: transparent; border: 2px solid #fff; color: #fff; padding: 10px 30px;
            border-radius: 50px; cursor: pointer; margin-top: 30px; font-weight: bold; font-size: 16px;
        }
        .btn-volver:hover { background: #fff; color: #000; }

        /* FOOTER MINIMALISTA */
        .main-footer-advanced { background-color: var(--color-dark-green); color: #fff; padding: 40px 20px; margin-top: auto; text-align: center; }
        .footer-minimal-content { display: flex; flex-direction: column; align-items: center; gap: 20px; }
        .footer-logo { font-size: 1.5em; color: #8cc63f; }
        .footer-logo h3 { color: #fff; margin: 10px 0; font-size: 24px; }
        .social-links a { color: #fff; margin: 0 15px; font-size: 24px; transition: color 0.3s; }
        .social-links a:hover { color: #8cc63f; }
        .footer-bottom { margin-top: 30px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; font-size: 16px; color: #b3b3b3; }

        @media(max-width: 768px) {
            .form-grid { grid-template-columns: 1fr; }
            .canvas-container { width: 280px; height: 500px; }
            .electric-border-canvas { width: 360px; height: 580px; }
            .pollutant-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>

<body>

    <header class="main-header">
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-bolt" style="color: var(--color-accent); margin-right: 10px;"></i> 
                <span>Calculadora Pro</span>
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="index.html" class="btn-header">Volver al Inicio</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <div class="container">
        
        <div class="intro-header" id="introHeader">
            <h1>Calculadora de Contaminantes Eléctricos</h1>
            <p>Captura tu inventario (mínimo 10 aparatos) para calcular tu consumo y las emisiones de CO₂, SO₂ y NOx.</p>
            <button class="btn-comenzar" onclick="mostrarModulo()">Iniciar Captura</button>
        </div>

        <div class="modulo-container" id="moduloContainer">
            <div class="form-card">
                <h3><i class="fas fa-plus-circle"></i> Agregar Aparato</h3>
                <div class="form-grid">
                    <div class="input-group">
                        <label>Aparato</label>
                        <input type="text" id="devName" placeholder="Ej. TV, PC...">
                    </div>
                    <div class="input-group">
                        <label>Watts</label>
                        <input type="number" id="devWatts" placeholder="W" min="1">
                    </div>
                    <div class="input-group">
                        <label>Horas/día</label>
                        <input type="number" id="devHours" placeholder="h" min="0" max="24">
                    </div>
                    <div class="input-group">
                        <label>Días/mes</label>
                        <input type="number" id="devDays" placeholder="días" min="1" max="31" value="30">
                    </div>
                </div>
                <div style="margin-top: 15px; text-align: right;">
                    <button class="btn-add" onclick="agregarDispositivo()">+ Agregar a la Lista</button>
                </div>
            </div>

            <div style="text-align: center; margin-bottom: 10px; font-weight: bold; color: #555;">
                Aparatos capturados: <span id="contadorDispositivos" style="color: var(--color-dark-green); font-size: 1.2em;">0</span>
                <span id="mensajeMinimo" style="font-size: 0.8em; display:block; font-weight: normal; color: #888;">(Meta: 10 aparatos)</span>
            </div>

            <div id="listaDispositivos" class="device-list"></div>
            
            <button class="btn-calcular-final" onclick="calcularTotal()">Calcular Resultados</button>
        </div>

        <div class="resultados-section" id="resultadosSection">
            <h2>Informe de Contaminantes</h2>
            
            <main class="main-container">
                <div class="card-container">
                    <div class="canvas-container">
                        <canvas id="electric-border-canvas" class="electric-border-canvas" width="400" height="600"></canvas>
                    </div>
                    <div class="content-container">
                        <span class="label-result">Costo Mensual</span>
                        <div class="title" id="resCosto">$0.00</div>
                        
                        <hr style="width: 60%; border-color: rgba(255,255,255,0.2); margin: 10px 0;">
                        
                        <div class="gha-valor" id="resKwh" style="font-size: 2em;">0</div>
                        <span class="label-result">Consumo (kWh)</span>
                        
                        <hr style="width: 60%; border-color: rgba(255,255,255,0.2); margin: 10px 0;">

                        <div class="gha-valor" id="resCarbono" style="color: #ff7043; font-size: 2em;">0</div>
                        <span class="label-result">CO₂e (kg)</span>
                        
                        <div class="pollutant-grid">
                            <div class="pollutant-box">
                                <span class="pollutant-val" id="resSO2">0 g</span>
                                <span class="pollutant-lbl">SO₂ (Lluvia Ácida)</span>
                            </div>
                            <div class="pollutant-box">
                                <span class="pollutant-val" id="resNOx">0 g</span>
                                <span class="pollutant-lbl">NOx (Smog)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <div class="technical-specs">
                <h4 style="color:#fff; margin-top:0; border-bottom:1px solid #555; padding-bottom:10px;">
                    <i class="fas fa-flask"></i> Fórmulas de Emisiones
                </h4>
                
                <div class="formula-box">
                    <span class="formula-title">Consumo (kWh)</span>
                    <code>E = (<span class="variable">Watts</span> × <span class="variable">Horas</span> × <span class="variable">Días</span>) / 1000</code>
                </div>

                <div class="formula-box">
                    <span class="formula-title">Factores de Emisión (Estimados)</span>
                    <code>CO₂ = <span class="variable">kWh</span> × 0.45 kg</code><br>
                    <code>SO₂ = <span class="variable">kWh</span> × 0.5 g</code><br>
                    <code>NOx = <span class="variable">kWh</span> × 0.8 g</code>
                </div>
            </div>

            <div class="chart-wrapper">
                <h3 style="color: var(--color-accent);">Contaminantes por Aparato</h3>
                <canvas id="pollutantChart"></canvas>
            </div>

            <div class="efficiency-message" id="msgEficiencia">
                <h3><i class="fas fa-check-circle"></i> ¡Excelente Eficiencia!</h3>
                <p>Tu consumo energético es bajo y responsable. Continúa manteniendo estos buenos hábitos para cuidar el planeta.</p>
            </div>

            <div class="recommendations-box" id="recommendationsBox">
                <h3><i class="fas fa-exclamation-triangle"></i> ¡Alerta de Consumo Alto!</h3>
                <p>Tu consumo ha superado los 150 kWh. Te recomendamos tomar las siguientes acciones:</p>
                <ul id="listaRecomendaciones"></ul>
            </div>

            <button class="btn-volver" onclick="resetear()">Nuevo Cálculo</button>
        </div>

    </div>

    <footer class="main-footer-advanced">
        <div class="footer-minimal-content">
            <div class="footer-logo">
                <i class="fas fa-leaf" style="font-size: 40px;"></i>
                <h3>HUELLA ECOLÓGICA</h3>
            </div>
            <div class="social-links">
                <a href="#"><i class="fab fa-facebook-f"></i></a>
                <a href="#"><i class="fab fa-instagram"></i></a>
                <a href="#"><i class="fab fa-twitter"></i></a>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Todos los derechos reservados © 2025.</p>
        </div>
    </footer>

    <script>
        // --- VARIABLES GLOBALES ---
        let inventario = [];

        // --- FUNCIONES INTERFAZ ---
        function mostrarModulo() {
            document.getElementById('introHeader').style.display = 'none';
            document.getElementById('moduloContainer').classList.add('visible');
        }

        // --- AGREGAR DISPOSITIVO ---
        function agregarDispositivo() {
            const name = document.getElementById('devName').value;
            const watts = parseFloat(document.getElementById('devWatts').value);
            const hours = parseFloat(document.getElementById('devHours').value);
            const days = parseFloat(document.getElementById('devDays').value);

            if(!name || isNaN(watts) || isNaN(hours) || isNaN(days)) {
                alert("Completa todos los campos correctamente.");
                return;
            }

            // CÁLCULOS POR DISPOSITIVO
            const kwh = (watts * hours * days) / 1000;
            const co2 = kwh * 0.45;    
            const so2 = kwh * 0.5;     
            const nox = kwh * 0.8;     

            const dispositivo = {
                id: Date.now(),
                name, watts, hours, days,
                kwhTotal: kwh,
                co2Total: co2,
                so2Total: so2,
                noxTotal: nox
            };

            inventario.push(dispositivo);
            actualizarContador();
            renderizarLista();
            limpiarInputs();
        }

        function limpiarInputs() {
            document.getElementById('devName').value = '';
            document.getElementById('devWatts').value = '';
            document.getElementById('devHours').value = '';
            document.getElementById('devName').focus();
        }

        function actualizarContador() {
            const count = inventario.length;
            const elem = document.getElementById('contadorDispositivos');
            elem.textContent = count;
            if(count >= 10) {
                elem.style.color = "#8cc63f";
                document.getElementById('mensajeMinimo').textContent = "(Meta cumplida)";
                document.getElementById('mensajeMinimo').style.color = "#8cc63f";
            }
        }

        function renderizarLista() {
            const container = document.getElementById('listaDispositivos');
            container.innerHTML = '';
            if (inventario.length === 0) {
                container.innerHTML = '<p style="text-align:center; color:#666;">Sin aparatos.</p>';
                return;
            }
            inventario.forEach(item => {
                const div = document.createElement('div');
                div.className = 'device-item';
                div.innerHTML = `
                    <div class="device-info">
                        <span class="device-name">${item.name}</span>
                        <span>${item.watts}W</span>
                        <span style="font-weight:bold; color:var(--color-mid-green)">${item.co2Total.toFixed(2)} kg CO₂</span>
                    </div>
                    <button class="btn-delete" onclick="eliminarDispositivo(${item.id})"><i class="fas fa-trash"></i></button>
                `;
                container.appendChild(div);
            });
        }

        function eliminarDispositivo(id) {
            inventario = inventario.filter(d => d.id !== id);
            actualizarContador();
            renderizarLista();
        }

        // --- CÁLCULO TOTAL ---
        let myChart = null;

        function calcularTotal() {
            if(inventario.length === 0) { alert("Captura al menos un aparato."); return; }

            let totalKwh = 0, totalCO2 = 0, totalSO2 = 0, totalNOx = 0;

            inventario.forEach(d => {
                totalKwh += d.kwhTotal;
                totalCO2 += d.co2Total;
                totalSO2 += d.so2Total;
                totalNOx += d.noxTotal;
            });

            // Costo estimado
            const tarifa = 3.50;
            const costo = totalKwh * tarifa;

            // MOSTRAR DATOS
            document.getElementById('resKwh').textContent = totalKwh.toFixed(2);
            document.getElementById('resCosto').textContent = '$' + costo.toLocaleString('en-US', {minimumFractionDigits: 2});
            document.getElementById('resCarbono').textContent = totalCO2.toFixed(2);
            document.getElementById('resSO2').textContent = totalSO2.toFixed(1) + ' g';
            document.getElementById('resNOx').textContent = totalNOx.toFixed(1) + ' g';

            // CAMBIO DE VISTA
            document.getElementById('moduloContainer').classList.remove('visible');
            document.getElementById('resultadosSection').classList.add('visible');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            initElectricBorder();
            generarGrafica();
            
            // --- LÓGICA DE MOSTRAR/OCULTAR RECOMENDACIONES ---
            gestionarRecomendaciones(totalKwh);
        }

        function gestionarRecomendaciones(kwhTotal) {
            const boxRec = document.getElementById('recommendationsBox');
            const boxMsg = document.getElementById('msgEficiencia');
            const lista = document.getElementById('listaRecomendaciones');
            lista.innerHTML = ''; // Limpiar lista previa

            // UMBRAL DE CONSUMO ALTO: 150 kWh
            if (kwhTotal > 150) {
                // Mostrar Recomendaciones
                boxRec.style.display = 'block';
                boxMsg.style.display = 'none';

                // Generar tips
                const tips = [
                    "Tu consumo es elevado. Revisa el aislamiento de tu hogar para evitar fugas de aire acondicionado.",
                    "Sustituye inmediatamente focos incandescentes por LED.",
                    "Desconecta aparatos en 'stand-by' como microondas y consolas.",
                    "Considera reemplazar aparatos viejos (refrigeradores, lavadoras) por modelos Inverter."
                ];
                
                tips.forEach(t => {
                    const li = document.createElement('li');
                    li.textContent = t;
                    lista.appendChild(li);
                });

            } else {
                // Ocultar Recomendaciones y mostrar felicitación
                boxRec.style.display = 'none';
                boxMsg.style.display = 'block';
            }
        }

        // --- GRÁFICA DE DESGLOSE ---
        function generarGrafica() {
            const ctx = document.getElementById('pollutantChart').getContext('2d');
            if (myChart) myChart.destroy();

            const labels = inventario.map(d => d.name);
            const dataCO2 = inventario.map(d => d.co2Total);

            myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'CO₂ Generado (kg)',
                        data: dataCO2,
                        backgroundColor: 'rgba(253, 216, 53, 0.7)',
                        borderColor: '#fdd835',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    plugins: { legend: { labels: { color: '#fff' } } },
                    scales: {
                        x: { ticks: { color: '#fff' }, grid: { color: 'rgba(255,255,255,0.1)' } },
                        y: { ticks: { color: '#fff' } }
                    }
                }
            });
        }

        function resetear() {
            inventario = [];
            actualizarContador();
            renderizarLista();
            limpiarInputs();
            document.getElementById('resultadosSection').classList.remove('visible');
            document.getElementById('introHeader').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // --- ANIMACIÓN ---
        function initElectricBorder() {
            const canvas = document.getElementById('electric-border-canvas');
            const ctx = canvas.getContext('2d');
            let time = 0;
            function draw() {
                if(!document.getElementById('resultadosSection').classList.contains('visible')) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.strokeStyle = '#fdd835'; ctx.lineWidth = 2; ctx.lineCap = 'round';
                time += 0.05;
                const off = 20; const w = canvas.width - off*2; const h = canvas.height - off*2;
                ctx.beginPath();
                for (let i = 0; i <= 100; i++) {
                    const p = i / 100;
                    let x, y;
                    if(p < 0.25) { x = off + (p/0.25)*w; y = off; }
                    else if (p < 0.5) { x = off + w; y = off + ((p-0.25)/0.25)*h; }
                    else if (p < 0.75) { x = off + w - ((p-0.5)/0.25)*w; y = off + h; }
                    else { x = off; y = off + h - ((p-0.75)/0.25)*h; }
                    const n = Math.sin(p*20+time)*3 + Math.cos(p*50-time)*2;
                    if(i===0) ctx.moveTo(x+n, y+n); else ctx.lineTo(x+n, y+n);
                }
                ctx.closePath(); ctx.stroke();
                requestAnimationFrame(draw);
            }
            draw();
        }
    </script>
</body>
</html>